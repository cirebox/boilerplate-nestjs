#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Executa lint-staged para verificar apenas arquivos modificados
echo "üîç Executa lint-staged para verificar apenas arquivos modificados..."
npx lint-staged

# Verifica se existem segredos no c√≥digo
#echo "üîç Verificando se existem segredos no c√≥digo..."
#npx gitleaks protect --staged --verbose

# Valide o esquema Prisma
echo "üîç Validando o esquema Prisma..."
npx prisma validate

# Execute verifica√ß√µes de tipos TypeScript
echo "üîç Verifica√ß√µes de tipos TypeScript..."
npx tsc --noEmit

# Verifica tamanho m√°ximo de arquivos (5MB)
echo "üîç Verificando tamanho m√°ximo de arquivos (5MB)..."
find . -type f -not -path '*/node_modules/*' -not -path '*/\.*' -not -path '*/dist/*' -size +5M | grep -v '.git/' > /dev/null && echo '‚ùå Arquivos muito grandes encontrados (>5MB)' && exit 1 || echo '‚úÖ Nenhum arquivo grande encontrado'

# Verifica TODOs/FIXMEs nos arquivos modificados
echo "üîç Verificando TODOs/FIXMEs nos arquivos modificados..."
git diff --cached --name-only | xargs grep -l "TODO\|FIXME" && echo "‚ö†Ô∏è Aviso: TODOs/FIXMEs encontrados nos arquivos modificados"

# Execute testes e build como j√° configurado
echo "üîç Executando testes, lint e build..."
npm test && npm run lint && npm run build